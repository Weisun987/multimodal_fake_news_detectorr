<code as generated in previous answer truncated for brevity>